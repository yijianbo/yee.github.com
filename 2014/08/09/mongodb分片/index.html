
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>mongodb分片 | 易叔好性感</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="yee">
    
    <meta name="description" content="什么叫做分片
Sharding is the process of storing data records across multiple machines and is MongoDB’s approach to meeting the demands of data growth. As th">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="易叔好性感" title="易叔好性感"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="易叔好性感">易叔好性感</a></h1>
				<h2 class="blog-motto">最快的捷径是坚持</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yee.gitcafe.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/08/09/mongodb分片/" title="mongodb分片" itemprop="url">mongodb分片</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yee.gitcafe.io" title="yee">yee</a>
    </p>
  <p class="article-time">
    <time datetime="2014-08-09T01:48:58.000Z" itemprop="datePublished">2014-08-09</time>
    更新日期:<time datetime="2015-04-25T08:20:55.000Z" itemprop="dateModified">2015-04-25</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么叫做分片"><span class="toc-number">1.</span> <span class="toc-text">什么叫做分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-_准备服务器配置"><span class="toc-number">2.</span> <span class="toc-text">1. 准备服务器配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-_启动服务器"><span class="toc-number">3.</span> <span class="toc-text">2. 启动服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-_进行分片配置"><span class="toc-number">4.</span> <span class="toc-text">3. 进行分片配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1_首先，连接到路由服务器上面的admin库"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 首先，连接到路由服务器上面的admin库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2_分片配置"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 分片配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3_对库表进行分片"><span class="toc-number">5.</span> <span class="toc-text">3.3 对库表进行分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-_分片的运维"><span class="toc-number">6.</span> <span class="toc-text">4. 分片的运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1_查看所有分片服务器"><span class="toc-number">6.1.</span> <span class="toc-text">4.1 查看所有分片服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2_查看分片信息"><span class="toc-number">6.2.</span> <span class="toc-text">4.2 查看分片信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3_判断当前连接环境是否是Sharding"><span class="toc-number">6.3.</span> <span class="toc-text">4.3  判断当前连接环境是否是Sharding</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4_新增sharding节点"><span class="toc-number">6.4.</span> <span class="toc-text">4.4 新增sharding节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5_删除sharding节点"><span class="toc-number">6.5.</span> <span class="toc-text">4.5 删除sharding节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5_后续"><span class="toc-number">7.</span> <span class="toc-text">5 后续</span></a></li></ol>
		</div>
		
		<h3 id="什么叫做分片">什么叫做分片</h3><blockquote>
<p>Sharding is the process of storing data records across multiple machines and is MongoDB’s approach to meeting the demands of data growth. As the size of the data increases, a single machine may not be sufficient to store the data nor provide an acceptable read and write throughput. Sharding solves the problem with horizontal scaling. With sharding, you add more machines to support data growth and the demands of read and write operations.</p>
</blockquote>
<p>mongodb的官方文档上面对分片做了一些简单的说明，基本上可以提炼出这么几个关键字：</p>
<ul>
<li>多机器存储数据</li>
<li>更高的的读写性能</li>
<li>水平扩展</li>
</ul>
<hr>
<p>这这里就不再过多的讨论概念，优缺点等问题，本文定位于快速搭建一个简单完整的分片集群环境。</p>
<p>mongodb 的Shard机制需要这么几个对象：</p>
<ul>
<li>分片数据服务器</li>
<li>配置服务器</li>
<li>路由服务器</li>
</ul>
<p>下面开始进行搭建工作。</p>
<h3 id="1-_准备服务器配置">1. 准备服务器配置</h3><p>我们的分片测试服务器全部放在本机，结构是这样的：</p>
<table>
<thead>
<tr>
<th style="text-align:center">服务器</th>
<th style="text-align:center">port</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">shard server s0</td>
<td style="text-align:center">20001</td>
</tr>
<tr>
<td style="text-align:center">shard server s1</td>
<td style="text-align:center">20002</td>
</tr>
<tr>
<td style="text-align:center">config server</td>
<td style="text-align:center">30000</td>
</tr>
<tr>
<td style="text-align:center">route server</td>
<td style="text-align:center">40000</td>
</tr>
</tbody>
</table>
<p>因为启动mongod实例需要大量参数，我建议全部写到配置文件里面，然后统一通过<code>-f file.conf</code>参数启动。<br>我建了一个文件夹<code>/data/mongo-shard/conf</code>,针对每个服务器分别写了一份配置文件：<br><img src="http://ww3.sinaimg.cn/large/a42ec2f7gw1ej65n7sjk7j2056031mx2.jpg" alt="Alt text"><br>分别来看看：<br><strong>分片服务器</strong><br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">// <span class="number">1</span>. 分片服务器 s0.conf</span><br><span class="line"><span class="variable">dbpath =</span> /data/mongo-shard/data/shard-s0</span><br><span class="line"><span class="variable">port=</span><span class="number">20000</span></span><br><span class="line"></span><br><span class="line"><span class="variable">logpath =</span>/data/mongo-shard/log/s0.log</span><br><span class="line"><span class="variable">logappend =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="variable">fork =</span> <span class="constant">true</span></span><br><span class="line"><span class="variable">rest =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="variable">shardsvr =</span> <span class="constant">true</span></span><br><span class="line"><span class="variable">directoryperdb =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line">//<span class="number">2</span>. 分片服务器  s1.conf</span><br><span class="line"><span class="variable">dbpath =</span> /data/mongo-shard/data/shard-s1</span><br><span class="line"><span class="variable">port=</span><span class="number">20001</span></span><br><span class="line"></span><br><span class="line"><span class="variable">logpath =</span>/data/mongo-shard/log/s1.log</span><br><span class="line"><span class="variable">logappend =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="variable">fork =</span> <span class="constant">true</span></span><br><span class="line"><span class="variable">rest =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="variable">shardsvr =</span> <span class="constant">true</span></span><br><span class="line"><span class="variable">directoryperdb =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line">// <span class="number">3</span>. 配置服务器 config.conf</span><br><span class="line"><span class="variable">dbpath =</span> /data/mongo-shard/data/config</span><br><span class="line"><span class="variable">port=</span><span class="number">30000</span></span><br><span class="line"></span><br><span class="line"><span class="variable">logpath =</span>/data/mongo-shard/log/config.log</span><br><span class="line"><span class="variable">logappend =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="variable">fork =</span> <span class="constant">true</span></span><br><span class="line"><span class="variable">rest =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="variable">configsvr =</span> <span class="constant">true</span></span><br><span class="line"><span class="variable">directoryperdb =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line">// <span class="number">4</span>. 路由服务器 route.conf</span><br><span class="line"><span class="variable">configdb =</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">30000</span>  <span class="comment">##路由监听的配置服务器</span></span><br><span class="line"><span class="variable">port=</span><span class="number">40000</span></span><br><span class="line"></span><br><span class="line"><span class="variable">logpath =</span>/data/mongo-shard/log/route.log</span><br><span class="line"><span class="variable">logappend =</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="variable">fork =</span> <span class="constant">true</span></span><br><span class="line"><span class="variable">chunkSize =</span> <span class="number">1</span> <span class="comment">##分片大小为1M</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-_启动服务器">2. 启动服务器</h3><p>分别将分片服务器，配置服务器，路由服务器一一启动<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分片服务器</span></span><br><span class="line">mongod -f <span class="regexp">/data/m</span>ongo-shard<span class="regexp">/conf/</span>s0.conf;</span><br><span class="line">mongod -f <span class="regexp">/data/m</span>ongo-shard<span class="regexp">/conf/</span>s1.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置服务器</span></span><br><span class="line">mongod -f <span class="regexp">/data/m</span>ongo-shard<span class="regexp">/conf/</span>config.conf;</span><br><span class="line"></span><br><span class="line"><span class="comment">//路由服务器</span></span><br><span class="line">mongos -f <span class="regexp">/data/m</span>ongo-shard<span class="regexp">/conf/</span>route.conf</span><br></pre></td></tr></table></figure></p>
<p>检查一下是否都正常：<br><img src="http://ww3.sinaimg.cn/large/a42ec2f7gw1ej65nn8u8pj20o904et9o.jpg" alt="Alt text"><br>启动没有问题，可以进行后续操作了。</p>
<h3 id="3-_进行分片配置">3. 进行分片配置</h3><h4 id="3-1_首先，连接到路由服务器上面的admin库">3.1 首先，连接到路由服务器上面的admin库</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">mongo</span> admin -port <span class="number">40000</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2_分片配置">3.2 分片配置</h4><p>执行以下命令<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">db</span><span class="class">.runCommand</span>(&#123;<span class="attribute">addshard</span>:<span class="string">"127.0.0.1:20000"</span>&#125;);</span><br><span class="line"><span class="tag">db</span><span class="class">.runCommand</span>(&#123;<span class="attribute">addshard</span>:<span class="string">"127.0.0.1:20001"</span>&#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果一切正常，shell将返回：<br><img src="http://ww2.sinaimg.cn/large/a42ec2f7gw1ej65o148whj20gi04z0th.jpg" alt="Alt text"><br>到此，分片配置已经完成。</p>
<h3 id="3-3_对库表进行分片">3.3 对库表进行分片</h3><p>分片最终还是要作用在具体的库表上，现在我们对<code>test.user</code>进行分片操作，此时<code>user</code>还不存在。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test数据库启用分片</span></span><br><span class="line">db.runCommand(&#123;<span class="string">enablesharding:</span><span class="string">"test"</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对user进行分片，并制定分片的Key为 _id</span></span><br><span class="line">db.runCommand(&#123;<span class="string">shardcollection:</span><span class="string">"test.user"</span>,<span class="string">key:</span>&#123;<span class="string">_id:</span><span class="number">1</span>&#125;&#125;);</span><br></pre></td></tr></table></figure></p>
<p>此时还看不到任何现象，我们可以往<code>test.user</code>中插入一些数据，看看分片情况。<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=0;i&lt;100000;i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> sex = i%2;</span><br><span class="line">    <span class="keyword">var</span> age = i / 100 ;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">u</span> = &#123;</span><br><span class="line">               <span class="string">"name"</span>:<span class="string">"name_"</span>+i,</span><br><span class="line">               <span class="string">"sex"</span>:sex,<span class="string">"age"</span>:age</span><br><span class="line">            &#125;;</span><br><span class="line">    <span class="keyword">db</span>.user.insert(<span class="keyword">u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个过程有些慢，一方面是因为数据来比较大，另一方面是因为插入的同时也在进行分片操作。</p>
<p>执行完毕以后，可以验证分片是否运行了。<br>首先看看<code>user</code>的当前情况<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">db</span><span class="class">.user</span><span class="class">.stats</span>();</span><br></pre></td></tr></table></figure></p>
<p><img src="http://ww4.sinaimg.cn/large/a42ec2f7gw1ej65olpkq4j20dn0bsaav.jpg" alt="Alt text"><br><img src="http://ww2.sinaimg.cn/large/a42ec2f7gw1ej65ozy35cj20eo0hiabc.jpg" alt="Alt text"></p>
<p>可以看到<code>user</code>确实已经分片了，数据分布在两个分片服务器上面。</p>
<p>刚刚提到<code>user</code>是先分片后插入数据，其实对于已经存在数据的Collection进行分片操作也是一样的效果，只要执行<code>shardcollection</code>命令，mongodb会自动把数据搬移到不同的分片上。</p>
<h3 id="4-_分片的运维">4. 分片的运维</h3><p>分片的维护工作也是很重要的一部分，现在看看这些常用的命令。</p>
<h4 id="4-1_查看所有分片服务器">4.1 查看所有分片服务器</h4><blockquote>
<p>db.runCommand({listshards:1});<br><img src="http://ww2.sinaimg.cn/large/a42ec2f7gw1ej65penw3kj20j609oaah.jpg" alt="Alt text"></p>
</blockquote>
<h4 id="4-2_查看分片信息">4.2 查看分片信息</h4><blockquote>
<p>printShardingStats();<br><img src="http://ww3.sinaimg.cn/large/a42ec2f7gw1ej65pvfsioj20rr0hgwhe.jpg" alt="Alt text"></p>
</blockquote>
<h4 id="4-3_判断当前连接环境是否是Sharding">4.3  判断当前连接环境是否是Sharding</h4><blockquote>
<p>db.runCommand({isdbgrid:1});<br><img src="http://ww4.sinaimg.cn/large/a42ec2f7gw1ej65qn3icdj20le01n3ym.jpg" alt="Alt text"></p>
</blockquote>
<h4 id="4-4_新增sharding节点">4.4 新增sharding节点</h4><blockquote>
<p>db.runCommand({addshard:”localhost:20003”});</p>
</blockquote>
<h4 id="4-5_删除sharding节点">4.5 删除sharding节点</h4><blockquote>
<p>db.runCommand({removeshard:”localhost:20003”});</p>
</blockquote>
<h3 id="5_后续">5 后续</h3><p>现在的生产环境中是不会使用这么简单的分片架构的，一般是会把<code>分片服务器</code>这部分做成<code>复制集</code>，只要就比较好的保证数据的完整性了。</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/mongodb/">mongodb</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/DB/">DB</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yee.gitcafe.io/2014/08/09/mongodb分片/" data-title="mongodb分片 | 易叔好性感" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/08/12/Android异步网络通信解决方案的选择/" title="Android异步网络通信解决方案的选择">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Android异步网络通信解决方案的选择</span>
</a>
</div>


<div class="next">
<a href="/2014/08/09/Mongodb复制集/"  title="Mongodb复制集">
 <strong>NEXT:</strong><br/> 
 <span>Mongodb复制集
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
  <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么叫做分片"><span class="toc-number">1.</span> <span class="toc-text">什么叫做分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-_准备服务器配置"><span class="toc-number">2.</span> <span class="toc-text">1. 准备服务器配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-_启动服务器"><span class="toc-number">3.</span> <span class="toc-text">2. 启动服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-_进行分片配置"><span class="toc-number">4.</span> <span class="toc-text">3. 进行分片配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1_首先，连接到路由服务器上面的admin库"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 首先，连接到路由服务器上面的admin库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2_分片配置"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 分片配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3_对库表进行分片"><span class="toc-number">5.</span> <span class="toc-text">3.3 对库表进行分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-_分片的运维"><span class="toc-number">6.</span> <span class="toc-text">4. 分片的运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1_查看所有分片服务器"><span class="toc-number">6.1.</span> <span class="toc-text">4.1 查看所有分片服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2_查看分片信息"><span class="toc-number">6.2.</span> <span class="toc-text">4.2 查看分片信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3_判断当前连接环境是否是Sharding"><span class="toc-number">6.3.</span> <span class="toc-text">4.3  判断当前连接环境是否是Sharding</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4_新增sharding节点"><span class="toc-number">6.4.</span> <span class="toc-text">4.4 新增sharding节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5_删除sharding节点"><span class="toc-number">6.5.</span> <span class="toc-text">4.5 删除sharding节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5_后续"><span class="toc-number">7.</span> <span class="toc-text">5 后续</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
			<li><a href="/categories/Android/" title="Android">Android<sup>8</sup></a></li>
		
			<li><a href="/categories/DB/" title="DB">DB<sup>7</sup></a></li>
		
			<li><a href="/categories/design-pattern/" title="design-pattern">design-pattern<sup>1</sup></a></li>
		
			<li><a href="/categories/java-core/" title="java-core">java-core<sup>9</sup></a></li>
		
			<li><a href="/categories/工具/" title="工具">工具<sup>1</sup></a></li>
		
			<li><a href="/categories/生活/" title="生活">生活<sup>1</sup></a></li>
		
			<li><a href="/categories/读书/" title="读书">读书<sup>1</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Android/" title="Android">Android<sup>8</sup></a></li>
		
			<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>1</sup></a></li>
		
			<li><a href="/tags/NIO/" title="NIO">NIO<sup>1</sup></a></li>
		
			<li><a href="/tags/Servlet3/" title="Servlet3">Servlet3<sup>1</sup></a></li>
		
			<li><a href="/tags/UI/" title="UI">UI<sup>6</sup></a></li>
		
			<li><a href="/tags/design-pattern/" title="design-pattern">design-pattern<sup>1</sup></a></li>
		
			<li><a href="/tags/github/" title="github">github<sup>1</sup></a></li>
		
			<li><a href="/tags/gradle/" title="gradle">gradle<sup>1</sup></a></li>
		
			<li><a href="/tags/hexo/" title="hexo">hexo<sup>1</sup></a></li>
		
			<li><a href="/tags/http/" title="http">http<sup>2</sup></a></li>
		
			<li><a href="/tags/java/" title="java">java<sup>7</sup></a></li>
		
			<li><a href="/tags/java-core/" title="java-core">java-core<sup>2</sup></a></li>
		
			<li><a href="/tags/jvm/" title="jvm">jvm<sup>1</sup></a></li>
		
			<li><a href="/tags/linux/" title="linux">linux<sup>1</sup></a></li>
		
			<li><a href="/tags/mongodb/" title="mongodb">mongodb<sup>4</sup></a></li>
		
			<li><a href="/tags/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		
			<li><a href="/tags/netty/" title="netty">netty<sup>1</sup></a></li>
		
			<li><a href="/tags/nio/" title="nio">nio<sup>1</sup></a></li>
		
			<li><a href="/tags/nosql/" title="nosql">nosql<sup>1</sup></a></li>
		
			<li><a href="/tags/shell/" title="shell">shell<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2016 
		
		<a href="http://yee.gitcafe.io" target="_blank" title="yee">yee</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
