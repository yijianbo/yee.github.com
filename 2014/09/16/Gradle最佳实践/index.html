
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Gradle最佳实践 | 易叔好性感</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="yee">
    
    <meta name="description" content="最近公司准备搭建一套自动化管理平台，在编译部署这个环节，要我做了一下技术调研选型，在这里把这个过程的实践部分记录一下，希望对有需要的同学有帮助。
在技术选择上，基本上大家首先会想到的是ant, maven这两个构建工具的元老，我一直觉得它们的用法都还是太复杂了，那些xml文件写起来复杂得很，估计和我">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="易叔好性感" title="易叔好性感"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="易叔好性感">易叔好性感</a></h1>
				<h2 class="blog-motto">最快的捷径是坚持</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yee.gitcafe.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/09/16/Gradle最佳实践/" title="Gradle最佳实践" itemprop="url">Gradle最佳实践</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yee.gitcafe.io" title="yee">yee</a>
    </p>
  <p class="article-time">
    <time datetime="2014-09-16T02:36:43.000Z" itemprop="datePublished">2014-09-16</time>
    更新日期:<time datetime="2015-04-25T08:20:55.000Z" itemprop="dateModified">2015-04-25</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-_安装"><span class="toc-number">1.</span> <span class="toc-text">1. 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-_介绍一下几个重要的概念"><span class="toc-number">2.</span> <span class="toc-text">2. 介绍一下几个重要的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1_Project"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Project</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2_Task"><span class="toc-number">3.</span> <span class="toc-text">2.2 Task</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3_plugin"><span class="toc-number">4.</span> <span class="toc-text">2.3 plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-_最佳实践操作部分"><span class="toc-number">5.</span> <span class="toc-text">3. 最佳实践操作部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1_单个java项目"><span class="toc-number">6.</span> <span class="toc-text">3.1 单个java项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2_单个WEB项目"><span class="toc-number">7.</span> <span class="toc-text">3.2 单个WEB项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3_多项目构建"><span class="toc-number">8.</span> <span class="toc-text">3.3 多项目构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4_Android项目的构建"><span class="toc-number">9.</span> <span class="toc-text">3.4 Android项目的构建</span></a></li></ol>
		</div>
		
		<p>最近公司准备搭建一套<code>自动化管理</code>平台，在<code>编译部署</code>这个环节，要我做了一下技术调研选型，在这里把这个过程的实践部分记录一下，希望对有需要的同学有帮助。</p>
<p>在技术选择上，基本上大家首先会想到的是<code>ant</code>, <code>maven</code>这两个构建工具的元老，我一直觉得它们的用法都还是太复杂了，那些xml文件写起来复杂得很，估计和我想法相似的人还是很多。在2010年出现了一位编译构建领域的新贵<code>gradle</code>,在业界声名鹊起，很多开源项目纷纷转投使用了它，这里面包括著名的<code>spring</code>,<code>hibernate</code>,最能说明事实的是google把<code>gradle</code>作为<code>android</code>的默认构建工具，在它的官方开发工具<code>android studio</code>中直接内置，由此可见<code>gradle</code>在java方向的项目构建上确实是实至名归的后起之秀，代表了构建的未来。</p>
<p>关于<code>gradle</code>的介绍网上还是很多的，我就不在这里啰嗦了，大家可以去<a href="http://www.gradle.org/" target="_blank" rel="external">官网</a>看看。在这篇文章里面就讨论一下在接触学习过程中的一些最佳实践。</p>
<h3 id="1-_安装">1. 安装</h3><p>安装的话不用太多废话，直接看步骤吧：</p>
<blockquote>
<ol>
<li>去<a href="http://www.gradle.org/downloads" target="_blank" rel="external">下载页</a>下载相应的软件包，注意版本的选择，建议选择<code>1.10</code>。我在这里栽了个跟头，直接选了<code>2.1</code>,在做<code>Android项目</code>的时候，总是编译通不过，最后才发现是Android的插件现在还只支持<code>1.10 ~~ 1.12</code>的版本，而且有比较严格的版本匹配。</li>
<li>解压下载包，配置环境变量，将<code>%GRADLE_HOME%/bin</code>加入到<code>path</code>中。</li>
<li>测试安装，在命令窗口输入命令： <code>gradle -v</code>,如果能看到gradle的版本信息介绍，那就是安装成功了。</li>
</ol>
</blockquote>
<h3 id="2-_介绍一下几个重要的概念">2. 介绍一下几个重要的概念</h3><p>网上都说gradle的文档写得很好，我自己却感觉我要的很大一部分东西都还没有，摸索了好几天才总算是找到了方向，能理解它的一些概念和机制，在这里我就总结一下我们需要关注的一些概念。</p>
<h4 id="2-1_Project">2.1 Project</h4><p><code>Project</code>是理解<code>gradle</code>体系的入口，看看它的定义：</p>
<blockquote>
<p>Every Gradle build is made up of one or more projects. What a project represents depends on what it is that you are doing with Gradle. For example, a project might represent a library JAR or a web application. It might represent a distribution ZIP assembled from the JARs produced by other projects. A project does not necessarily represent a thing to be built. It might represent a thing to be done, such as deploying your application to staging or production environments.</p>
</blockquote>
<p><code>gradle</code>所操作的就是一个或者多个<code>project</code>,<code>project</code>是个虚拟的概念，它具体是什么取决于你在操作的内容，它可能是一个<code>jar library</code>，<code>web application</code> ,<code>android app</code>,<code>zip</code>,<code>common dir</code>等等。</p>
<p>我来说得更明白一些，一个<code>project</code>就是一个构建对象，它的展现点就是一个gradle的配置文件:<code>build.gradle</code>.我们只要这么理解就可以了：一个<code>build.gradle</code>文件对应一个<code>project</code>.</p>
<p>既然说到了 <code>build.gradle</code>文件，那就来看看它长什么样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#39;java&#39;&#10;group = &#39;WService&#39;&#10;&#10;//&#35774;&#32622;&#32534;&#30721;&#10;tasks.withType(org.gradle.api.tasks.compile.JavaCompile) &#123;&#10;    options.encoding = &#34;UTF-8&#34;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里先不解释，我们只需要知道它只是一个普通的配置文件一样的东西，其实是gralde的脚本文件。顺带说一下gradle的脚本是基于<code>groovy</code>构建的，作为写<code>java</code>的同学，<code>groovy</code>还是非常亲切的，这个在使用过程中可以感受到。</p>
<h3 id="2-2_Task">2.2 Task</h3><p>官网关于<code>Task</code>的描述：</p>
<blockquote>
<p>Each project is made up of one or more tasks. A task represents some atomic piece of work which a build performs. This might be compiling some classes, creating a JAR, generating javadoc, or publishing some archives to a repository.</p>
</blockquote>
<p><code>task</code>是构成<code>Project</code>的单位。说得通俗点，<code>task</code>就是对于具体事情的包装。例如<code>编译class文件</code>，这个事情就可以作为一个<code>task</code>.</p>
<p>关于<code>task</code>,我们就在这里展开讲一下它的一些特性以及探讨下如何使用。</p>
<ol>
<li><p>定义一个task</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#26222;&#36890;&#26041;&#24335;&#10;task hello1 &#60;&#60; &#123;&#10;&#9;println(&#34;Hello,world&#34;);&#10;&#9;System.out.print(&#34;hello, print by java&#34;);&#10;&#125;&#10;// &#22312;TaskContain&#20013;&#28155;&#21152;Task&#10;tasks.create(name: &#39;hello2&#39;) &#60;&#60; &#123;&#10;    println &#39;hello4&#39;&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定一个task的属性</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#33258;&#23450;&#20041;TASK &#23646;&#24615;&#10;task hello3 &#60;&#60; &#123;&#10;    description = &#34;this is hello3&#34;&#10;    println description&#10;&#125;&#10;// &#36890;&#36807;&#23646;&#24615;&#26041;&#24335;&#10;task hello4 &#60;&#60; &#123;&#10;    println description&#10;&#125;&#10;hello4.configure &#123;&#10;    description = &#34;this is hello4&#34;&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Task之间的依赖关系</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#23450;&#20041;&#26102;&#22768;&#26126;&#10;task hello5(dependsOn:hello4) &#60;&#60; &#123;&#10;    println &#39;hello5&#39;&#10;&#125;&#10;// &#20808;&#23450;&#20041;&#65292;&#20877;&#36890;&#36807;&#23646;&#24615;&#25351;&#23450;&#10;task hello6 &#60;&#60; &#123;&#10;    println &#39;hello6&#39;&#10;&#125;&#10;hello6.dependsOn hello5</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>关于<code>task</code>我们了解这么多基本上就够了，如果要要深度定制，那就还需要了解更多，这个就自己去翻文档吧。</p>
<h3 id="2-3_plugin">2.3 plugin</h3><p><code>plugin</code>是<code>gradle</code>最重要的组成部分。怎么描述<code>plugin</code>呢,这么说吧，<code>plugin</code>根据自己的目标，封装了一批<code>task</code>，然后通过<code>project</code>对象暴露的api，把自己嵌入到<code>project</code>中，从而可以直接以独立对象的方式使用plugin.<br><code>gradle</code> 内置了很多<code>plugin</code>，第三方也提供了非常丰富的plugin，如果还不满足自己的需求的话，我们也可以实现自定义的<code>plugin</code>.对于我们来说，基本上只需要关注这三个plugin:</p>
<ul>
<li>java </li>
<li>war</li>
<li>android</li>
</ul>
<p>本篇的<code>最佳实践</code>部分的内容也就是围绕着如何使用它们进行探讨。对于这些标准的<code>plugin</code>的使用，它们提供了一些默认的约定，避不开的一个问题就是<code>项目结构</code>.gradle默认的的项目结构遵循<code>maven</code>的约定，具体可见<a href="http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html" target="_blank" rel="external">链接
</a><br><img src="http://blog-yee.qiniudn.com/module_layout.png" alt=""></p>
<p>我们的已有项目肯定不能支持对这种项目结构的迁移，就算勉强迁移，估计也很容易出现各种问题。而对于新项目，直接使用Idea或者eclipse也是无法直接构建出这种结构的。最重要的是，我们的项目已经存在比较固定的项目结构习惯，要做变化还是比较需要时间适应的，所以一个最基本的底线就是即便使用gradle作为编译管理工具，依然要保持我们已有的项目结构。</p>
<p>这个问题<code>gradle</code>肯定是考虑到了的，它这里又提出了一个<code>source set</code>的概念，通过配置<code>source set</code>，能非常方便的修改相应路径，很自然的适应已有的项目结构。</p>
<p>好了，基本上需要了解的概念已经介绍完毕，现在进入我们的<code>最佳实践</code>.</p>
<h3 id="3-_最佳实践操作部分">3. 最佳实践操作部分</h3><p>现在<code>java</code>体系的项目无非三种类型:<code>jar</code>,<code>web</code>,<code>android</code>。这三种项目可能各自存在项目依赖，从这个范围来说，这里整理一下我们的实践部分的目标：</p>
<ul>
<li>单个Java项目的编译打包</li>
<li>单个Web项目的编译打包</li>
<li>单个Android项目的打包</li>
<li>存在项目依赖关系的多项目打包</li>
</ul>
<h3 id="3-1_单个java项目">3.1 单个java项目</h3><p>首先来看我们的项目结构：<br><img src="http://blog-yee.qiniudn.com/jar_layout.png" alt=""><br>这个结构应该是非常”不标准”,要把gradle用在这样的项目中，虽然我摸索了一些时间，但是最后脚本写出来，真的还是非常简单的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#23450;&#20041;&#25105;&#20204;&#22312;&#36825;&#20010;project&#20013;&#20351;&#29992; java plugin&#10;apply plugin: &#39;java&#39;&#10;group = &#39;WService&#39;&#10;&#10;//&#35774;&#32622;&#32534;&#30721;&#10;tasks.withType(org.gradle.api.tasks.compile.JavaCompile) &#123;&#10;    options.encoding = &#34;UTF-8&#34;&#10;&#125;&#10;&#10;//&#23450;&#20041;&#32534;&#35793;&#30340;&#26102;&#20505;&#20381;&#36182;&#30340;&#21253;&#36335;&#24452;&#10;dependencies &#123;&#10;    compile fileTree(dir: &#39;libs&#39;, include: &#39;*.jar&#39;)&#10;&#125;&#10;&#10;// &#20462;&#25913;&#40664;&#35748;&#30340;source set :main &#30340;&#36335;&#24452;&#10;sourceSets &#123;&#10;    main &#123;&#10;        java.srcDir &#39;src&#39;&#10;        resources &#123;&#10;            srcDir &#39;src&#39;&#10;            exclude &#39;*.json&#39;&#10;        &#125;&#10;        output.resourcesDir = &#34;build/out/$&#123;project.name&#125;/classes&#34;&#10;        output.classesDir   = &#34;build/out/$&#123;project.name&#125;/classes&#34;&#10;    &#125;&#10;&#10;&#125;&#10;&#10;jar &#123;&#10;    //1. &#25171;&#21253;&#25152;&#26377;&#30340;&#20381;&#36182;&#65292;&#23601;&#26159;&#25152;&#35859;&#30340;fat jar&#10;    //from &#123; configurations.compile.collect &#123; it.isDirectory() ? it : zipTree(it) &#125; &#125;&#10;&#10;    //2. &#23450;&#20041;manifest,&#23545;&#20110;jar&#21253;&#26469;&#35828;&#65292;&#23601;&#26159;&#23450;&#20041;MANIFEST.MF&#20869;&#23481;&#10;    manifest &#123;&#10;        attributes(&#10;                &#34;Main-Class&#34;: &#34;cn.shellinfo.weipass.service.Starter&#34;&#10;                , &#34;Class-Path&#34;: &#34;libs/**&#34;&#10;        )&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行<code>gradle build</code>, 看看最终打包后的效果：<br><img src="http://blog-yee.qiniudn.com/jar_out_1.png" alt=""><br>我们看到多了一个<code>build</code>目录，同时下面有两个文件夹需要关注下</p>
<ul>
<li>libs 这里是jar包的输出目录</li>
<li>out 这个是我自己定义的，会把class文件，配置文件输出到这里。</li>
</ul>
<p>最后需要验证，如何知道gradle打包出来的文件是正确的。一般就是jar包运行一下，看看是否正常运行。为了更清楚一些，我们把 <code>WService.jar</code>解压看下目录结构，直接看最后的结构是否正确更加清楚。<br><img src="http://blog-yee.qiniudn.com/jar_out_2.png" alt=""><br>这里可以确定：</p>
<ul>
<li>class文件全部打包过来</li>
<li>配置文件也全部打包复制好了</li>
<li>META-INF的配置也已经OK，当然在图上看不到</li>
</ul>
<p>单个java项目的实践应该算是很详细了。具体的脚本细节其实我都写了注释，这个得按照自己的实际情况来修改，但是大部分的项目应该就是这些方面需要做些微调：</p>
<ul>
<li>项目结构，这个的修改点在<code>sourceSets</code>中。</li>
<li>META-INF信息，这个在<code>manifest</code>节点中修改。</li>
<li>项目依赖，一般通过<code>dependencies</code>配置即可。</li>
</ul>
<h3 id="3-2_单个WEB项目">3.2 单个WEB项目</h3><p>WEB项目其实也挺简单的，首先来看WEB项目示例的结构：<br><img src="http://blog-yee.qiniudn.com/web_layout.png" alt=""><br>可以看到，这个项目结构还是非常复杂的，如果按gradle的标准结构来玩，真的头都大了。但是当我写完构建脚本后，真的好惊讶，怎么可以这么简单：<br>首先,在gradle.properties中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemProp.file.encoding=UTF-8&#10;webInfDir=web/WEB-INF/</span><br></pre></td></tr></table></figure></p>
<p>其次，在build.gradle中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#34;war&#34;&#10;group = &#34;MyServer&#34;&#10;&#10;//&#35774;&#32622;&#32534;&#30721;&#10;tasks.withType(org.gradle.api.tasks.compile.JavaCompile) &#123;&#10;    options.encoding = &#34;UTF-8&#34;&#10;&#125;&#10;&#10;//&#23450;&#20041;&#32534;&#35793;&#30340;&#26102;&#20505;&#20381;&#36182;&#30340;&#21253;&#36335;&#24452;&#10;dependencies &#123;&#10;    compile fileTree(dir: &#34;$&#123;project.webInfDir&#125;/lib&#34;, include: &#34;*.jar&#34;)&#10;&#125;&#10;&#10;// &#20462;&#25913;WEB-INO, web.xml&#31561;&#36335;&#24452;&#10;war &#123;&#10;    // &#23450;&#20041;&#22909;web.xml&#10;    webXml file(&#34;$&#123;project.webInfDir&#125;/web.xml&#34;)&#10;    //&#23558;web&#30446;&#24405;&#19979;&#30340;&#20869;&#23481;&#20840;&#37096;Copy&#21040;war&#21253;&#30340;&#26681;&#30446;&#24405;&#19979;&#10;    from &#34;web&#34;&#10;&#10;&#125;&#10;&#10;// &#20462;&#25913;&#40664;&#35748;&#30340;source set :main &#30340;&#36335;&#24452;&#10;sourceSets &#123;&#10;    main &#123;&#10;        java.srcDir &#34;src&#34;&#10;        resources&#123;&#10;            srcDirs=[&#39;src&#39;]&#10;        &#125;&#10;        output.resourcesDir = &#34;build/out/$&#123;project.name&#125;/classes&#34;&#10;        output.classesDir  = &#34;build/out/$&#123;project.name&#125;/classes&#34;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面这个脚本真的是简单到爆！具体结果我也验证了，直接把war包丢到Tomcat里面，运行都是OK的。也来看看生成的war包的结构吧：<br><img src="http://blog-yee.qiniudn.com/web_out.png" alt=""></p>
<p><code>war plugin</code> 很简单，需要的关注点也就这么些：</p>
<ul>
<li>项目结构，这个的修改点在<code>sourceSets</code>中。</li>
<li>项目依赖，一般通过<code>dependencies</code>配置即可。</li>
<li>web.xml的位置 在<code>war</code>节点中修改</li>
<li>lib, 页面文件， 资源文件等，这些只要能复制到war的根目录下就OK了</li>
</ul>
<h3 id="3-3_多项目构建">3.3 多项目构建</h3><p>在实际的开发过程中，往往存在项目依赖的情况，一个业务项目依赖于一个或多个公共项目。gradle对这种情况也做了很好的支持。下面来看实例：<br>我这里存在两个项目：</p>
<ul>
<li>PosBp web项目，依赖于下面的common</li>
<li>WeipassCommon  普通java公共项目</li>
</ul>
<p>来看看项目结构：<br><img src="http://blog-yee.qiniudn.com/multi_layout.png" alt=""></p>
<p>现在开始对这两个项目进行构建：</p>
<ol>
<li><p>在这两个项目的上一级根目录建建一个<code>setting.gradle</code>,内容如下：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &#39;WeipassCommon&#39;, &#39;PosBp&#39;</span><br></pre></td></tr></table></figure>
<p> 这里就是定义此构建项目包含了两个子项目，默认子项目名就是文件夹名，当然也可以进行修    改。</p>
</li>
</ol>
<ol>
<li><p><code>gradle</code>对于多项目构建提供<code>subprojects</code>,<code>allprojects</code>等方式来配置公共信息，这里我们在根目录中在新建文件：<code>build.gradle</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#21508;&#23376;&#39033;&#30446;&#30340;&#20844;&#20849;&#37197;&#32622;&#37117;&#21487;&#20197;&#20889;&#21040;&#36825;&#37324;&#65292;&#36825;&#37324;&#23454;&#22312;&#27809;&#21861;&#20844;&#20849;&#30340;&#65292;&#25105;&#23601;&#27809;&#20889;&#10;subprojects &#123;&#10;   // version = &#39;1.0&#39;&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置子项目<code>PosBp</code>,在PosBp下新建<code>build.gradle</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#34;war&#34;&#10;group = &#34;PosBp&#34;&#10;&#10;//&#35774;&#32622;&#32534;&#30721;&#10;tasks.withType(org.gradle.api.tasks.compile.JavaCompile) &#123;&#10;    options.encoding = &#34;UTF-8&#34;&#10;&#125;&#10;&#10;&#10;//&#23450;&#20041;&#32534;&#35793;&#30340;&#26102;&#20505;&#20381;&#36182;&#30340;&#21253;&#36335;&#24452;,&#20197;&#21450;&#39033;&#30446;&#20381;&#36182;&#10;dependencies &#123;&#10;    compile fileTree(dir: &#34;$&#123;project.webInfDir&#125;/lib&#34;, include: &#34;*.jar&#34;)&#10;    compile project(&#39;:WeipassCommon&#39;)&#10;&#125;&#10;&#10;// &#20462;&#25913;WEB-INO, web.xml&#31561;&#36335;&#24452;&#10;war &#123;&#10;    from &#34;web&#34;&#10;&#125;&#10;&#10;&#10;&#10;// &#20462;&#25913;&#40664;&#35748;&#30340;source set :main &#30340;&#36335;&#24452;&#10;sourceSets &#123;&#10;    main &#123;&#10;        java.srcDir &#34;src&#34;&#10;        resources&#123;&#10;            srcDirs=[&#39;src&#39;]&#10;        &#125;&#10;        output.resourcesDir = &#34;build/out/$&#123;project.name&#125;/classes&#34;&#10;        output.classesDir  = &#34;build/out/$&#123;project.name&#125;/classes&#34;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p> 这个和配置普通的WEB项目没有任何区别，唯一需要注意的是在<code>dependencies</code>节点中添加    了一个项目依赖<code>compile project(&#39;:WeipassCommon&#39;)</code></p>
</li>
<li><p>配置另一个子项目<code>WeipassCommon</code>,在WeipassCommon下新建build.gradle文件：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#39;java&#39;&#10;group = &#39;WeipassComm&#39;&#10;&#10;//&#35774;&#32622;&#32534;&#30721;&#10;tasks.withType(org.gradle.api.tasks.compile.JavaCompile) &#123;&#10;    options.encoding = &#34;UTF-8&#34;&#10;&#125;&#10;&#10;//&#23450;&#20041;&#32534;&#35793;&#30340;&#26102;&#20505;&#20381;&#36182;&#30340;&#21253;&#36335;&#24452;&#10;dependencies &#123;&#10;    compile fileTree(dir: &#39;lib&#39;, include: &#39;*.jar&#39;)&#10;&#125;&#10;&#10;// &#20462;&#25913;&#40664;&#35748;&#30340;source set :main &#30340;&#36335;&#24452;&#10;sourceSets &#123;&#10;    main &#123;&#10;        java.srcDir &#39;src&#39;&#10;        output.resourcesDir = &#34;build/out/$&#123;project.name&#125;/classes&#34;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在根目录下运行<code>gradle build</code>，查看输出<br> <img src="http://blog-yee.qiniudn.com/multi_out.png" alt=""><br> 我们看到PosBp所依赖的WeipassCommon项目已经以jar包的方式被打包到lib目录下面    了，符合我们的期待吧。</p>
</li>
</ol>
<p>多项目构建稍微复杂一些，这里的步骤还是比较复杂，以后再研究下怎么优化吧。</p>
<h3 id="3-4_Android项目的构建">3.4 Android项目的构建</h3><p>关于android项目的构建，网上的资源很多，我也不做太多的描述。先看项目结构：<br><img src="http://blog-yee.qiniudn.com/Android_layout.png" alt=""><br>这是非常标准的Android项目结构。</p>
<p>下面来看基本上很标准的Android gradle 构建脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#23450;&#20041;&#19968;&#19979;&#23545;Android plugin lib &#30340;&#20381;&#36182;&#10;buildscript &#123;&#10;    repositories &#123;&#10;        mavenCentral()&#10;    &#125;&#10;    dependencies &#123;&#10;        classpath &#39;com.android.tools.build:gradle:0.11+&#39;&#10;    &#125;&#10;&#125;&#10;&#10;apply plugin: &#39;android&#39;&#10;&#10;&#10;//&#28155;&#21152;android&#20381;&#36182;libs&#10;dependencies &#123;&#10;    compile fileTree(dir: &#39;libs&#39;, include: &#39;*.jar&#39;)&#10;&#125;&#10;&#10;android &#123;&#10;    compileSdkVersion 15&#10;    buildToolsVersion &#34;20&#34;&#10;    //&#31614;&#21517;&#10;    signingConfigs &#123;&#10;        myConfig &#123;&#10;            storeFile file(&#34;/Users/yee/.android/debug.keystore&#34;)&#10;            storePassword &#34;android&#34;&#10;            keyAlias &#34;androiddebugkey&#34;&#10;            keyPassword &#34;android&#34;&#10;        &#125;&#10;    &#125;&#10;&#10;    // &#32534;&#35793;&#29256;&#26412;&#10;    defaultConfig &#123;&#10;        versionCode 1&#10;        versionName getVersionName()&#10;        minSdkVersion 15&#10;        targetSdkVersion 15&#10;    &#125;&#10;&#10;    // &#20195;&#30721;&#28151;&#28102;&#10;    /*buildTypes&#123;&#10;        release &#123;&#10;            signingConfig signingConfigs.myConfig&#10;            runProguard true&#10;            proguardFile &#39;proguard.cfg&#39;&#10;        &#125;&#10;    &#125;*/&#10;&#10;// &#39033;&#30446;&#32467;&#26500;&#37325;&#23450;&#20041;&#10;sourceSets &#123;&#10;        main &#123;&#10;            manifest &#123;&#10;                srcFile &#39;AndroidManifest.xml&#39;&#10;            &#125;&#10;            java &#123;&#10;                srcDir &#39;src&#39;&#10;            &#125;&#10;            res &#123;&#10;                srcDir &#39;res&#39;&#10;            &#125;&#10;            assets &#123;&#10;                srcDir &#39;assets&#39;&#10;            &#125;&#10;            resources &#123;&#10;                srcDir &#39;src&#39;&#10;            &#125;&#10;            aidl &#123;&#10;                srcDir &#39;src&#39;&#10;            &#125;&#10;        &#125;&#10;    &#125;&#10;&#125;&#10;&#10;android &#123;&#10;    lintOptions &#123;&#10;        abortOnError false&#10;    &#125;&#10;&#125;&#10;&#10;tasks.withType(org.gradle.api.tasks.compile.JavaCompile) &#123;&#10;    options.encoding = &#34;UTF-8&#34;&#10;&#125;&#10;//&#26367;&#25442;AndroidManifest.xml&#30340;UMENG_CHANNEL_VALUE&#23383;&#31526;&#20018;&#20026;&#28192;&#36947;&#21517;&#31216;&#10;/*android.applicationVariants.all&#123; variant -&#62;&#10;    variant.processManifest.doLast&#123;&#10;        copy&#123;&#10;            from(&#34;$&#123;buildDir&#125;/manifests&#34;)&#123;&#10;                include &#34;$&#123;variant.dirName&#125;/AndroidManifest.xml&#34;&#10;            &#125;&#10;            into(&#34;$&#123;buildDir&#125;/manifests/$variant.name&#34;)&#10;&#10;            filter&#123;&#10;                String line -&#62; line.replaceAll(&#34;UMENG_CHANNEL_VALUE&#34;, &#34;$variant.name&#34;)&#10;            &#125;&#10;&#10;            variant.processResources.manifestFile = file(&#34;$&#123;buildDir&#125;/manifests/$&#123;variant.name&#125;/$&#123;variant.dirName&#125;/AndroidManifest.xml&#34;)&#10;        &#125;&#10;    &#125;&#10;&#125;*/&#10;&#10;//&#28192;&#36947;&#10;/* productFlavors &#123;&#10;     google&#123;&#10;&#10;     &#125;&#10;     tantai&#123;&#10;&#10;     &#125;&#10; &#125;*/</span><br></pre></td></tr></table></figure></p>
<p>最后 <code>gradle  build</code><br><img src="http://blog-yee.qiniudn.com/Android_out.png" alt=""><br>可以看到 <code>apk文件</code>已经生成。验证一下就可以了。</p>
<p>到此为止，我们的开发中可能的模式基本上都走了一边，应该算很详细的一个实践了。关于gradle,我觉得目前网上的资料是有蛮多，但是没有太多有参考价值的。官方文档看起来是比较详细了，但是对于脚本的属性介绍还是欠缺，我都是直接翻API到类定义里面去找的。</p>
<p>最后，个人觉得有这么几个部分还是挺重要的，这里罗列一下，仅供参考</p>
<ul>
<li>Task 的定义，操作等：<a href="http://www.gradle.org/docs/current/userguide/tutorial_using_tasks.html" target="_blank" rel="external">链接</a></li>
<li>文件操作：<a href="http://www.gradle.org/docs/current/userguide/working_with_files.html" target="_blank" rel="external">链接</a></li>
<li>Ant相关：<a href="http://www.gradle.org/docs/current/userguide/ant.html" target="_blank" rel="external">链接</a></li>
</ul>
<p>在准备这个的过程中，<code>google</code>,<code>stackoverflow</code>提供了非常多的有帮助有价值的资料，再次感慨翻墙的价值。</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/gradle/">gradle</a><a href="/tags/工具/">工具</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/工具/">工具</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yee.gitcafe.io/2014/09/16/Gradle最佳实践/" data-title="Gradle最佳实践 | 易叔好性感" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/14/SSO-prictice-in-webmd/" title="SSO-prictice-in-web">
  <strong>PREVIOUS:</strong><br/>
  <span>
  SSO-prictice-in-web</span>
</a>
</div>


<div class="next">
<a href="/2014/09/02/Android中Gif图片的播放实现/"  title="Android中Gif图片的播放实现">
 <strong>NEXT:</strong><br/> 
 <span>Android中Gif图片的播放实现
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
  <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-_安装"><span class="toc-number">1.</span> <span class="toc-text">1. 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-_介绍一下几个重要的概念"><span class="toc-number">2.</span> <span class="toc-text">2. 介绍一下几个重要的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1_Project"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Project</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2_Task"><span class="toc-number">3.</span> <span class="toc-text">2.2 Task</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3_plugin"><span class="toc-number">4.</span> <span class="toc-text">2.3 plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-_最佳实践操作部分"><span class="toc-number">5.</span> <span class="toc-text">3. 最佳实践操作部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1_单个java项目"><span class="toc-number">6.</span> <span class="toc-text">3.1 单个java项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2_单个WEB项目"><span class="toc-number">7.</span> <span class="toc-text">3.2 单个WEB项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3_多项目构建"><span class="toc-number">8.</span> <span class="toc-text">3.3 多项目构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4_Android项目的构建"><span class="toc-number">9.</span> <span class="toc-text">3.4 Android项目的构建</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
			<li><a href="/categories/Android/" title="Android">Android<sup>8</sup></a></li>
		
			<li><a href="/categories/DB/" title="DB">DB<sup>6</sup></a></li>
		
			<li><a href="/categories/design-pattern/" title="design-pattern">design-pattern<sup>1</sup></a></li>
		
			<li><a href="/categories/java-core/" title="java-core">java-core<sup>9</sup></a></li>
		
			<li><a href="/categories/工具/" title="工具">工具<sup>1</sup></a></li>
		
			<li><a href="/categories/生活/" title="生活">生活<sup>1</sup></a></li>
		
			<li><a href="/categories/读书/" title="读书">读书<sup>1</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Android/" title="Android">Android<sup>8</sup></a></li>
		
			<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>1</sup></a></li>
		
			<li><a href="/tags/NIO/" title="NIO">NIO<sup>1</sup></a></li>
		
			<li><a href="/tags/Servlet3/" title="Servlet3">Servlet3<sup>1</sup></a></li>
		
			<li><a href="/tags/UI/" title="UI">UI<sup>6</sup></a></li>
		
			<li><a href="/tags/design-pattern/" title="design-pattern">design-pattern<sup>1</sup></a></li>
		
			<li><a href="/tags/github/" title="github">github<sup>1</sup></a></li>
		
			<li><a href="/tags/gradle/" title="gradle">gradle<sup>1</sup></a></li>
		
			<li><a href="/tags/hexo/" title="hexo">hexo<sup>1</sup></a></li>
		
			<li><a href="/tags/http/" title="http">http<sup>2</sup></a></li>
		
			<li><a href="/tags/java/" title="java">java<sup>7</sup></a></li>
		
			<li><a href="/tags/java-core/" title="java-core">java-core<sup>2</sup></a></li>
		
			<li><a href="/tags/jvm/" title="jvm">jvm<sup>1</sup></a></li>
		
			<li><a href="/tags/linux/" title="linux">linux<sup>1</sup></a></li>
		
			<li><a href="/tags/mongodb/" title="mongodb">mongodb<sup>3</sup></a></li>
		
			<li><a href="/tags/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		
			<li><a href="/tags/netty/" title="netty">netty<sup>1</sup></a></li>
		
			<li><a href="/tags/nio/" title="nio">nio<sup>1</sup></a></li>
		
			<li><a href="/tags/nosql/" title="nosql">nosql<sup>1</sup></a></li>
		
			<li><a href="/tags/shell/" title="shell">shell<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yee.gitcafe.io" target="_blank" title="yee">yee</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
